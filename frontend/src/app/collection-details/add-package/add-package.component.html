<form [formGroup]="form" (submit)="submit($event)">
    <div class="dpm-text-title" mat-dialog-title>Add Package To Collection</div>
    <p class="mt-3">Select the package and collection below.</p>
    <div mat-dialog-content class="py-4">
        <div class="d-flex input-row">
            <div class="input-control">
                <mat-label class="d-block mb-2">Package</mat-label>

                <app-input
                    placeholder="catalog/package"
                    [group]="form"
                    controlName="packageSlug"
                    inputStyle="flat"
                    [matAutocomplete]="auto"
                    [error]="form | inputError: 'packageSlug' | async"
                ></app-input>
                <mat-autocomplete #auto="matAutocomplete" class="search-autocomplete">
                    <mat-option *ngIf="!autoCompleteResult && packageNameControl.value.length > 1">
                        <mat-spinner [diameter]="30" class="ml-3"></mat-spinner>
                    </mat-option>
                    <ng-container *ngIf="autoCompleteResult">
                        <mat-option
                            *ngFor="let option of autoCompleteResult.packages"
                            [value]="option.identifier.catalogSlug + '/' + option.identifier.packageSlug"
                        >
                            <div class="d-flex">
                                <div>
                                    <app-avatar class="align-top user-img" [user]="option.creator" [size]="40">
                                    </app-avatar>
                                </div>

                                <div class="autocomplete-contents">
                                    <div class="autocomplete-title">
                                        {{ option.identifier.catalogSlug + " / " + option.identifier.packageSlug }}
                                    </div>

                                    <div class="autocomplete-description">{{ option.description }}</div>
                                </div>
                            </div>
                        </mat-option>
                    </ng-container>
                </mat-autocomplete>
            </div>
        </div>
        <div class="d-flex input-row mt-3">
            <div class="input-control">
                <mat-label class="d-block mb-2">Collection</mat-label>

                <mat-select controlName="collectionSlug" [(value)]="selectedCollectionSlug">
                    <mat-option *ngFor="let collection of collections" [value]="collection.identifier.collectionSlug">
                        {{ collection.name }}
                    </mat-option>
                </mat-select>
            </div>
        </div>

        <div class="text-danger mt-3" *ngIf="state === 'ERROR'">
            <ng-container [ngSwitch]="error">
                <ng-container *ngSwitchCase="'CATALOG_NOT_FOUND'">
                    No catalog with that identifier is found on this registry
                </ng-container>
                <ng-container *ngSwitchCase="'PACKAGE_NOT_FOUND'">
                    No package with that identifier is found on this registry.
                </ng-container>
                <ng-container *ngSwitchCase="'COLLECTION_NOT_FOUND'">
                    No collection with that identifier is found on this registry.
                </ng-container>
                <ng-container *ngSwitchDefault>
                    Error occured while adding a package to the collection. Please try again later, or contact support.
                </ng-container>
            </ng-container>
        </div>
    </div>
    <div mat-dialog-actions class="d-flex justify-content-end">
        <button type="submit" class="ml-auto app-raised-button" [disabled]="form.invalid">
            <span>Add</span>
        </button>
    </div>
</form>
