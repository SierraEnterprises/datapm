<form [formGroup]="form" (submit)="submit($event)" id="addUser">
    <div mat-dialog-title id="contentTitle">Add User</div>
    <div mat-dialog-content id="contentBorder">
        <div class="d-flex flex-row bd-highlight py-4 shadow-div">
            <div class="bd-highlight w-100">
                <div class="div-answer">
                    <app-input
                        class="flat-input-parent"
                        placeholder="username or email address"
                        [group]="form"
                        [control]="usernameControl"
                        controlName="username"
                        inputStyle="flat"
                        [matAutocomplete]="auto"
                        [error]="form | inputError: 'username' | async"
                    ></app-input>
                    <mat-autocomplete
                        #auto="matAutocomplete"
                        class="search-autocomplete"
                        (optionSelected)="autoCompleteOptionSelected($event)"
                    >
                        <mat-option *ngIf="!autoCompleteResult && usernameControl.value.length > 1"
                            >Loading...</mat-option
                        >
                        <ng-container *ngIf="autoCompleteResult">
                            <mat-option *ngFor="let option of autoCompleteResult.users" [value]="option.username">
                                <div class="autocomplete-title">{{ option.username }}</div>
                                <div *ngIf="option.emailAddress != null" class="autocomplete-description">
                                    {{ option.emailAddress }}
                                </div>
                            </mat-option>
                        </ng-container>
                    </mat-autocomplete>
                    <div class="text-danger mt-3" *ngIf="state === 'ERROR'">
                        <ng-container [ngSwitch]="error">
                            <ng-container *ngSwitchCase="'CANNOT_SET_PACKAGE_CREATOR_PERMISSIONS'">
                                You can not change the permissions of the package owner.
                            </ng-container>
                            <ng-container *ngSwitchCase="'USER_NOT_FOUND'">
                                There is no user with that username on this registry.
                            </ng-container>
                            <ng-container *ngSwitchDefault>
                                Error occured while adding a user permission to the collection
                            </ng-container>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div mat-dialog-actions class="text-right pb-3">
        <button mat-button type="submit" class="ml-auto save-btn" [disabled]="form.invalid">
            <span>add</span>
        </button>
    </div>
</form>
