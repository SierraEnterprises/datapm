<div class="container p-0 mb-3" id="packageIssues">
    <div>
        <button class="app-outlined-button" (click)="navigateToNewIssuePage()">Open a new issue</button>
    </div>
    <div class="main-wrapper">
        <div class="issue-wrapper issue-header">
            <a class="example-section">
                <mat-checkbox [(ngModel)]="allIssuesSelected" (change)="toggleAllIssuesSelection($event.checked)">
                </mat-checkbox>
            </a>
            <a
                (click)="toggleIncludeOpenIssues()"
                class="issue-tab issue-tab-item"
                [class.active]="includeOpenIssues && !includeClosedIssues"
            >
                Open
            </a>
            <a
                (click)="toggleIncludeClosedIssues()"
                class="issue-tab issue-tab-item"
                [class.active]="!includeOpenIssues && includeClosedIssues"
            >
                Closed
            </a>
            <a
                (click)="toggleIncludeAllIssues()"
                class="issue-tab issue-tab-item"
                [class.active]="includeOpenIssues && includeClosedIssues"
            >
                All
            </a>
            <a class="issue-tab right-tab"> Opened by </a>
            <div class="bd-highlight right-tab" *ngIf="anyIssueSelected">
                <a [matMenuTriggerFor]="menu" class="menu-btn mr-3 issue-tab">
                    Actions <i class="fas fa-chevron-down"></i>
                </a>
                <mat-menu #menu="matMenu">
                    <button mat-menu-item id="issueBtn" (click)="openSelectedIssues()">
                        <span class="package-dark-gray">Open</span>
                    </button>
                    <button mat-menu-item id="issueBtn" (click)="closeSelectedIssues()">
                        <span class="package-dark-gray">Close</span>
                    </button>
                    <button mat-menu-item id="issueBtn" (click)="deleteSelectedIssues()">
                        <span class="package-dark-gray">Delete</span>
                    </button>
                </mat-menu>
            </div>
        </div>

        <!-- when there are opened or closed issues -->
        <ng-container *ngIf="state === State.SUCCESS">
            <div *ngFor="let issue of issues" class="issue-wrapper">
                <div class="d-flex flex-row bd-highlight">
                    <section class="example-section">
                        <mat-checkbox (change)="toggleIssue(issue, $event.checked)" [ngModel]="issue.checked">
                        </mat-checkbox>
                    </section>
                    <div *ngIf="issue.status == 'OPEN'; else closedIssueIcon" class="bd-highlight open-issue">
                        <em class="fas fa-exclamation"></em>
                    </div>
                    <ng-template #closedIssueIcon>
                        <div class="bd-highlight closed-issue">
                            <em class="fas fa-check"></em>
                        </div>
                    </ng-template>
                    <div class="d-flex flex-column bd-highlight">
                        <div class="bd-highlight">
                            <a class="package-details-title" [routerLink]="issue.issueNumber"> {{ issue.subject }} </a>
                        </div>
                        <div class="bd-highlight">
                            <div class="package-light-gray">
                                #{{ issue.issueNumber }} opened {{ issue.createdAt | timeAgo }} by
                                {{ issue.author.username }}
                            </div>
                        </div>
                    </div>
                    <div class="bd-highlight align-self-center ml-auto">
                        <img class="img-comments" [src]="getUserAvatar(issue.author.username) | async" />
                    </div>
                </div>
            </div>
            <div *ngIf="hasMore" class="container text-center mt-3">
                <button
                    class="app-outlined-button ctaButton"
                    [disabled]="loadingMoreIssues"
                    (click)="loadMoreIssues()"
                    style="padding: 8px 40px"
                >
                    Load more
                </button>
            </div>
        </ng-container>

        <!-- when issues are being loaded -->
        <div class="issue-wrapper text-center" *ngIf="state === State.LOADING">
            <div class="package-dark-gray py-5">Loading issues...</div>
        </div>

        <!-- when there are no open issues -->
        <div class="issue-wrapper text-center" *ngIf="state === State.NO_OPEN_ISSUES">
            <div class="package-dark-gray py-5">
                There are no open issues.
                <br />
                Click the <span (click)="toggleIncludeClosedIssues()">'Closed'</span> tab to view closed issues
            </div>
        </div>
        <!-- when there are no closed issues -->
        <div class="issue-wrapper text-center" *ngIf="state === State.NO_CLOSED_ISSUES">
            <div class="package-dark-gray py-5">
                There are no closed issues. <br />
                Click the <span (click)="toggleIncludeOpenIssues()">'Open'</span> tab to view open issues
            </div>
        </div>
        <!-- when there are no open/closed issues -->
        <div class="issue-wrapper text-center" *ngIf="state === State.NO_ISSUES">
            <div class="package-dark-gray py-5">
                There are no issues. <br />
                Click to the <span (click)="toggleIncludeAllIssues()">'open a new issue'</span> button to create one
                issue.
            </div>
        </div>
    </div>
</div>
<ng-template #loadingTemplate> Loading... </ng-template>
